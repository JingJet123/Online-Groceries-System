CREATE TABLE Customer(
	CustID BIGINT GENERATED ALWAYS AS IDENTITY,
	Username VARCHAR(15) NOT NULL UNIQUE,
	Password VARCHAR(20) NOT NULL,
	CustName VARCHAR(50) NOT NULL,
	CustContact VARCHAR(20) NOT NULL,
	CustEmail VARCHAR(100) NOT NULL UNIQUE,
	CustAddress VARCHAR(200) NOT NULL,
	ProfileImg BLOB,
PRIMARY KEY(CustID)
);

CREATE TABLE Staff(
	StfID BIGINT GENERATED ALWAYS AS IDENTITY,
	Username VARCHAR(15) NOT NULL UNIQUE,
	Password VARCHAR(20) NOT NULL,
	StfName VARCHAR(50) NOT NULL,
	StfContact VARCHAR(20) NOT NULL,
	StfEmail VARCHAR(100) NOT NULL UNIQUE,
	StfSalary DOUBLE NOT NULL,
	StfRole CHAR NOT NULL,
	ProfileImg BLOB NOT NULL,
	IsDeleted BOOLEAN NOT NULL DEFAULT False,
PRIMARY KEY(StfID)
);

CREATE TABLE Category(
	CategoryID BIGINT GENERATED ALWAYS AS IDENTITY,
	CategoryName VARCHAR(50) NOT NULL,
	IsDeleted BOOLEAN NOT NULL DEFAULT False,
PRIMARY KEY(CategoryID)
);

CREATE TABLE SubCategory(
	SubCategoryID BIGINT GENERATED ALWAYS AS IDENTITY,
	SubCategoryName VARCHAR(50) NOT NULL,
	IsDeleted BOOLEAN NOT NULL DEFAULT False,
	CategoryID BIGINT NOT NULL,
PRIMARY KEY(SubCategoryID),
FOREIGN KEY(CategoryID) REFERENCES Category(CategoryID)
);

CREATE TABLE Product(
	ProdID BIGINT GENERATED ALWAYS AS IDENTITY,
	ProdName VARCHAR(180) NOT NULL,
	UnitPrice DOUBLE NOT NULL,
	Stock INTEGER NOT NULL,
	Supplier VARCHAR(100) NOT NULL,
	ProdImg BLOB NOT NULL,
	IsDeleted BOOLEAN NOT NULL DEFAULT False,
	SubCategoryID BIGINT NOT NULL,
PRIMARY KEY(ProdID),
FOREIGN KEY(SubCategoryID) REFERENCES SubCategory(SubCategoryID)
);

CREATE TABLE Cart(
	CartID BIGINT GENERATED ALWAYS AS IDENTITY,
	CustID BIGINT NOT NULL UNIQUE,
PRIMARY KEY(CartID),
FOREIGN KEY(CustID) REFERENCES Customer(CustID)
);

CREATE TABLE CartItem(
	CartID BIGINT NOT NULL,
	ProdID BIGINT NOT NULL,
	Quantity INTEGER NOT NULL,
PRIMARY KEY(CartID,ProdID),
FOREIGN KEY(CartID) REFERENCES Cart(CartID),
FOREIGN KEY(ProdID) REFERENCES Product(ProdID)
);

CREATE TABLE Orders(
	OrderID BIGINT GENERATED ALWAYS AS IDENTITY,
	OrderDate TIMESTAMP NOT NULL,
	OrderStatus VARCHAR(30) NOT NULL,
	TotalAmount DOUBLE NOT NULL,
	CustID BIGINT NOT NULL,
	StfID BIGINT,
PRIMARY KEY(OrderID),
FOREIGN KEY(CustID) REFERENCES Customer(CustID),
FOREIGN KEY(StfID) REFERENCES Staff(StfID)
);

CREATE TABLE OrderDetails(
	OrderID BIGINT NOT NULL,
	ProdID BIGINT NOT NULL,
	Quantity INTEGER NOT NULL,
	SubTotal DOUBLE NOT NULL,
PRIMARY KEY(OrderID,ProdID),
FOREIGN KEY(OrderID) REFERENCES Orders(OrderID),
FOREIGN KEY(ProdID) REFERENCES Product(ProdID)
);

CREATE TABLE ShippingDetails(
	ShippingID BIGINT GENERATED ALWAYS AS IDENTITY,
	ShippingDate DATE,
	ShippingAddress VARCHAR(180) NOT NULL,
	OrderID BIGINT NOT NULL UNIQUE,
PRIMARY KEY(ShippingID),
FOREIGN KEY(OrderID) REFERENCES Orders(OrderID)
);

CREATE TABLE Payment(
	PayID BIGINT GENERATED ALWAYS AS IDENTITY,
	PayType VARCHAR(50) NOT NULL,
	PayDate TIMESTAMP NOT NULL,
	PayAmount DOUBLE NOT NULL,
	OrderID BIGINT NOT NULL UNIQUE,
PRIMARY KEY(PayID),
FOREIGN KEY(OrderID) REFERENCES Orders(OrderID)
);

CREATE TABLE PromotionItem(
	StfID BIGINT NOT NULL,
	ProdID BIGINT NOT NULL,
	StartDate DATE NOT NULL,
	EndDate DATE NOT NULL,
	PromoRate DOUBLE NOT NULL,
PRIMARY KEY(StfID,ProdID,StartDate,EndDate),
FOREIGN KEY(StfID) REFERENCES Staff(StfID),
FOREIGN KEY(ProdID) REFERENCES Product(ProdID)
);

CREATE TABLE Comment(
	CommentID BIGINT GENERATED ALWAYS AS IDENTITY,
	Rating INTEGER NOT NULL,
	Message VARCHAR(300) NOT NULL,
	CmtDate TIMESTAMP NOT NULL,
	CustID BIGINT NOT NULL,
	ProdID BIGINT NOT NULL,
PRIMARY KEY(CommentID),
FOREIGN KEY(CustID) REFERENCES Customer(CustID),
FOREIGN KEY(ProdID) REFERENCES Product(ProdID)
);

CREATE TABLE CommentReply(
	CmtReplyID BIGINT GENERATED ALWAYS AS IDENTITY,
	Message VARCHAR(300) NOT NULL,
	ReplyDate TIMESTAMP NOT NULL,
	CommentID BIGINT NOT NULL,
	StfID BIGINT NOT NULL,
PRIMARY KEY(CmtReplyID),
FOREIGN KEY(CommentID) REFERENCES Comment(CommentID),
FOREIGN KEy(StfID) REFERENCES Staff(StfID)
);

CREATE TABLE Feedback(
	FeedbackID BIGINT GENERATED ALWAYS AS IDENTITY,
	Category VARCHAR(20) NOT NULL,
	Message VARCHAR(300) NOT NULL,
	FdbkDate TIMESTAMP NOT NULL,
	CustID BIGINT NOT NULL,
	OrderID BIGINT NOT NULL,
PRIMARY KEY(FeedbackID),
FOREIGN KEY(CustID) REFERENCES Customer(CustID),
FOREIGN KEY(OrderID) REFERENCES Orders(OrderID)
);

CREATE TABLE FeedbackReply(
	FdbkReplyID BIGINT GENERATED ALWAYS AS IDENTITY,
	Message VARCHAR(300) NOT NULL,
	ReplyDate TIMESTAMP NOT NULL,
	FeedbackID BIGINT NOT NULL,
	StfID BIGINT NOT NULL,
PRIMARY KEY(FdbkReplyID),
FOREIGN KEY(FeedbackID) REFERENCES Feedback(FeedbackID),
FOREIGN KEY(StfID) REFERENCES Staff(StfID)
);
